<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TinyLink Dashboard</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>

  <header>
    <h1>TinyLink Dashboard</h1>
  </header>

  <div class="container">

    <!-- Alert Messages -->
    <% if (message) { %>
      <div class="alert <%= alert %>">
        <%= message %>
      </div>
    <% } %>

    <!-- Create Short URL Form -->
    <form action="/shorten" method="POST" id="linkForm" class="create-form">
      <input 
        type="text" 
        name="originalUrl" 
        placeholder="Enter long URL"
        required
      >

      <input 
        type="text" 
        name="customName" 
        placeholder="Custom Code (optional)"
      >

      <button type="submit" id="submitBtn">Shorten URL</button>
    </form>

    <!-- Links Table -->
    <% if (!links || links.length === 0) { %>
      <p class="empty">No links created yet...</p>
    <% } else { %>

      <table>
        <thead>
          <tr>
            <th>Code</th>
            <th>Original URL</th>
            <th>Clicks</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <% links.forEach(link => { %>
            <tr>

              <!-- Short Code -->
              <td>
                <a 
                  href="/<%= link.code %>" 
                  target="_blank" 
                  class="link-code">
                  <%= link.code %>
                </a>
              </td>

              <!-- Long URL FIXED -->
              <td class="truncate" title="<%= link.url %>">
                <%= link.url %>
              </td>

              <!-- Clicks -->
              <td><%= link.clicks %></td>

              <!-- Actions -->
              <td class="actions">

                <button 
                  type="button" 
                  class="copy-btn"
                  onclick="copyURL('<%= link.code %>')">
                  Copy
                </button>

                <form 
                  action="/delete/<%= link.code %>" 
                  method="POST" 
                  class="inline-form">
                  <button type="submit" class="delete-btn">Delete</button>
                </form>

              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>

    <% } %>

  </div>

  <footer>
    &copy; <%= new Date().getFullYear() %> TinyLink
  </footer>

  <script>
    // Copy to clipboard
    function copyURL(code) {
      const url = `${window.location.origin}/${code}`;
      navigator.clipboard.writeText(url).then(() => {
        alert("Copied: " + url);
      });
    }

    // Disable button during submit
    const form = document.getElementById("linkForm");
    const submitBtn = document.getElementById("submitBtn");

    form.addEventListener("submit", () => {
      submitBtn.disabled = true;
      submitBtn.innerText = "Processing...";
    });
  </script>

</body>
</html>
