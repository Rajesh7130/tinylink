<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TinyLink Dashboard</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <header>
    <h1>TinyLink Dashboard</h1>
  </header>

  <div class="container">

    <!-- Alert Messages -->
    <% if (message) { %>
      <div class="alert <%= alert %>">
        <%= message %>
      </div>
    <% } %>

    <!-- Create Short URL Form -->
    <div class="form-section">
      <form action="/shorten" method="POST" id="linkForm" class="create-form">
        <input 
          type="text" 
          name="originalUrl" 
          placeholder="Enter long URL"
          required
          class="form-input"
        >
        <input 
          type="text" 
          name="customName" 
          placeholder="Custom Code (optional)"
          class="form-input"
        >
        <button type="submit" id="submitBtn" class="submit-btn">Shorten URL</button>
      </form>
    </div>

    <!-- Search/Filter Section -->
    <div class="search-section">
      <input 
        type="text" 
        id="searchInput" 
        placeholder="Search by code or URL..."
        class="search-input"
      >
      <button type="button" onclick="filterLinks()" class="search-btn">Search</button>
    </div>

    <!-- Links Table -->
    <% if (!links || links.length === 0) { %>
      <p class="empty">No links created yet...</p>
    <% } else { %>
      <table>
        <thead>
          <tr>
            <th>Short Code</th>
            <th>Target URL</th>
            <th>Clicks</th>
            <th>Last Clicked</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% links.forEach(link => { %>
            <tr>
              <td>
                <a href="/<%= link.code %>" target="_blank" class="link-code"><%= link.code %></a>
              </td>
              <td class="truncate" title="<%= link.url %>"><%= link.url %></td>
              <td><%= link.clicks %></td>
              <td>
                <%= link.last_clicked ? new Date(link.last_clicked).toLocaleString() : 'Never' %>
              </td>
              <td class="actions">
                <button type="button" class="copy-btn" onclick="copyURL('<%= link.code %>')">Copy</button>
                <form action="/delete/<%= link.code %>" method="POST" class="inline-form">
                  <button type="submit" class="delete-btn">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>
  </div>

  <footer>
    &copy; <%= new Date().getFullYear() %> TinyLink
  </footer>

  <!-- Running Dinosaur Loader Overlay -->
  <div id="dinoLoadingOverlay" class="dino-loading-overlay">
    <div class="dino-game-container">
      <!-- Running Dinosaur -->
      <div class="dino-runner">
        <div class="dino-body">
          <div class="dino-head"></div>
          <div class="dino-eye"></div>
          <div class="dino-arm"></div>
          <div class="dino-legs">
            <div class="leg leg-1"></div>
            <div class="leg leg-2"></div>
          </div>
          <div class="dino-tail"></div>
        </div>
      </div>
      
      <!-- Ground with moving lines -->
      <div class="ground-container">
        <div class="ground-line"></div>
        <div class="ground-line"></div>
        <div class="ground-line"></div>
      </div>
    </div>
    
    <p class="dino-loading-text">Creating your TinyLink... ðŸš€</p>
  </div>

  <script>
    // Copy to clipboard
    function copyURL(code) {
      const url = `${window.location.origin}/${code}`;
      navigator.clipboard.writeText(url).then(() => {
        alert("Copied: " + url);
      });
    }

    // Search/filter the links
    function filterLinks() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      const rows = document.querySelectorAll('tbody tr');
      rows.forEach(row => {
        const code = row.querySelector('.link-code').textContent.toLowerCase();
        const url = row.querySelector('.truncate').textContent.toLowerCase();
        row.style.display = (code.includes(input) || url.includes(input)) ? '' : 'none';
      });
    }

    // Show dino loader on form submit
    const form = document.getElementById("linkForm");
    const submitBtn = document.getElementById("submitBtn");
    const dinoOverlay = document.getElementById("dinoLoadingOverlay");

    form.addEventListener("submit", (e) => {
      dinoOverlay.style.display = 'flex';
      submitBtn.disabled = true;
      submitBtn.innerText = "Processing...";
    });
  </script>
</body>
</html>
